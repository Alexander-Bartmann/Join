<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: contacts.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: contacts.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Loads all contacts from the server and displays them on the page.
 * @async
 * @function loadAll
 * @returns {Promise&lt;void>}
 */
async function loadAll() {
    await loadContacts();
}

/**
 * Fetches the contacts from the server and organizes them by their first letter.
 * Then, it loads and displays each contact group.
 * @async
 * @function loadContacts
 * @returns {Promise&lt;void>}
 */
async function loadContacts() {
    const response = await fetch(BASE_URL + "Contacts.json");
    const contacts = await response.json();
    const contactContainer = document.getElementById("showContacts");
    if (!contactContainer) return;    
    contactContainer.innerHTML = "";
    const letters = Object.keys(contacts).sort();    
    for (let i = 0; i &lt; letters.length; i++) {
        loadContactsSecondFunction(letters[i], contacts[letters[i]], contactContainer);
    }
}

/**
 * Generates and appends HTML for each contact group based on the first letter of the contact names.
 * @function loadContactsSecondFunction
 * @param {string} letter - The first letter of the contact group.
 * @param {Array} contactsForLetter - The contacts under the specific letter group.
 * @param {HTMLElement} contactContainer - The container element where contacts will be displayed.
 * @returns {void}
 */
function loadContactsSecondFunction(letter, contactsForLetter, contactContainer) {
    let letterHTML = `&lt;div class="contact-letter-section">&lt;h2 class="letter-border">${letter}&lt;/h2>`;  
    for (let j = 0; j &lt; contactsForLetter.length; j++) {
        const contact = contactsForLetter[j];
        const initials = getInitials(contact.name);
        letterHTML += getLoadContactTemplate(contact, initials);
    }
    letterHTML += '&lt;/div>';
    contactContainer.innerHTML += letterHTML;
}

/**
 * Hides the "new contact" and "edit contact" forms.
 * @async
 * @function cancelCreateContact
 * @returns {Promise&lt;void>}
 */
async function cancelCreateContact() {
    const newContactForm = document.getElementById("newContactForm");
    const editContactForm = document.getElementById("editContactForm");
    if (newContactForm) newContactForm.classList.add("hidden");
    if (editContactForm) editContactForm.classList.add("hidden");
}

/**
 * Displays the "new contact" form and applies a blur background.
 * @async
 * @function renderAddContactForm
 * @returns {Promise&lt;void>}
 */
async function renderAddContactForm() {
    const newContactForm = document.getElementById("newContactForm");
    newContactForm.classList.remove("hidden");
    newContactForm.classList.add("bg-blur");
}

/**
 * Creates a new contact and saves it to the server after validation.
 * @async
 * @function createContact
 * @returns {Promise&lt;void>}
 */
async function createContact() {
    const nameInput = document.getElementById("newContactName");
    const emailInput = document.getElementById("newContactEmail");
    const phoneInput = document.getElementById("newContactPhone");
    const name = nameInput.value;
    const email = emailInput.value;
    const phone = phoneInput.value;
    const bgColor = getRandomColor();    
    if (!name || !email || !phone) {
        alert("Please fill in all fields.");
        return;
    }    
    const contact = { name, email, phone, bgColor};
    const firstLetter = name.charAt(0).toUpperCase();
    try {
        const response = await fetch(BASE_URL + "Contacts.json");
        const contacts = await response.json();
        if (!contacts) {
            contacts = {};
        }
        if (!contacts[firstLetter]) {
            contacts[firstLetter] = [];
        }
        contacts[firstLetter].push(contact);
        await fetch(BASE_URL + "Contacts.json", {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(contacts),
        });
        await loadContacts();
        cancelCreateContact();
        nameInput.value = "";
        emailInput.value = "";
        phoneInput.value = "";
    } catch (error) {
        console.error("Error while adding the contact:", error);
    }
}

/**
 * Retrieves the initials of a contact's name.
 * @function getInitials
 * @param {string} name - The full name of the contact.
 * @returns {string} The initials of the contact's name.
 */
function getInitials(name) {
    if (currentUserName == "") {
        currentUserName = name;
    }
    const nameParts = name.split(' ');
    let initials = '';
    for (let i = 0; i &lt; nameParts.length; i++) {
        initials += nameParts[i][0];
    }
    return initials.toUpperCase();
}

/**
 * Generates a random color in hexadecimal format.
 * @function getRandomColor
 * @returns {string} A random hex color code.
 */
function getRandomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i &lt; 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

/**
 * Displays detailed information of a contact in a modal-like container.
 * @async
 * @function displayContactInfo
 * @param {string} name - The name of the contact.
 * @param {string} email - The email of the contact.
 * @param {string} phone - The phone number of the contact.
 * @param {string} initials - The initials of the contact.
 * @param {string} bgColor - The background color for the contact display.
 * @returns {Promise&lt;void>}
 */
async function displayContactInfo(name, email, phone, initials, bgColor) {
    const contactInfoContainer = document.getElementById("contactInfo");
    const contactContainer = document.getElementById("contactContainer");
    if (!contactInfoContainer) {
        console.log("Contact info container not found.");
        return;
    }
    contactInfoContainer.innerHTML = getContactInfoTemplate(name, email, phone, initials, bgColor);
    contactContainer.classList.remove("sehr-hidden");
    contactContainer.classList.add("show");
}

/**
 * Closes the contact information modal.
 * @function closeContactInfo
 * @returns {void}
 */
function closeContactInfo() {
    const contactContainer = document.getElementById("contactContainer");
    contactContainer.classList.add("sehr-hidden");
    contactContainer.classList.remove("show");
}

/**
 * Edits an existing contact's information.
 * @async
 * @function editContact
 * @param {string} contactEmail - The email of the contact to be edited.
 * @returns {Promise&lt;void>}
 */
async function editContact(contactEmail) {
    const response = await fetch(BASE_URL + "Contacts.json");
    const contacts = await response.json();
    if (!contacts) {
        console.log("No contacts found in Firebase.");
        return;
    }
    const letters = Object.keys(contacts);
    let foundContact = null;
    for (let i = 0; i &lt; letters.length; i++) {
        const letter = letters[i];
        const contactGroup = contacts[letter];
        foundContact = contactGroup.find(c => c.email === contactEmail);
        if (foundContact) break;
    }
    if (!foundContact) {
        console.log("Contact not found.");
        return;
    }
    const nameInput = document.getElementById("editContactName");
    const emailInput = document.getElementById("editContactEmail");
    const phoneInput = document.getElementById("editContactPhone");
    if (nameInput &amp;&amp; emailInput &amp;&amp; phoneInput) {
        nameInput.value = foundContact.name;
        emailInput.value = foundContact.email;
        phoneInput.value = foundContact.phone;
    }
    const editContactForm = document.getElementById("editContactForm");
    if (editContactForm) {
        editContactForm.classList.remove("hidden");
        editContactForm.classList.add("bg-blur");
        editContactForm.dataset.bgColor = foundContact.bgColor;
    }

    editContactForm.dataset.currentEmail = contactEmail;
    getCurrentMailForButtons(contactEmail)
}

/**
 * Saves the edited contact details back to the server.
 * @async
 * @function saveEditedContact
 * @returns {Promise&lt;void>}
 */
async function saveEditedContact() {
    const { name, email, phone, currentEmail, bgColor } = getEditedContactInputs();
    if (!name || !email || !phone || !currentEmail) {
        alert("Please fill in all fields.");
        return;
    }
    const contacts = await fetchContacts();
    if (!contacts) return console.log("No contacts found in Firebase.");
    const updatedContact = { name, email, phone, bgColor };
    const { oldLetter, newLetter } = getLetterGroups(contacts, name, currentEmail);
    modifyContacts(contacts, updatedContact, oldLetter, newLetter, currentEmail);
    await saveContacts(contacts);
    finalizeContactEditing(updatedContact);
}

/**
 * Collects the edited contact data from the form.
 * @function getEditedContactInputs
 * @returns {Object} The edited contact's name, email, phone, bgColor, and currentEmail.
 */
function getEditedContactInputs() {
    const form = document.getElementById("editContactForm");
    return {
        name: document.getElementById("editContactName")?.value.trim(),
        email: document.getElementById("editContactEmail")?.value.trim(),
        phone: document.getElementById("editContactPhone")?.value.trim(),
        bgColor: form?.dataset.bgColor,
        currentEmail: form?.dataset.currentEmail,
    };
}

/**
 * Fetches all contacts from the server.
 * @async
 * @function fetchContacts
 * @returns {Promise&lt;Object>} The contacts object from the server.
 */
async function fetchContacts() {
    const response = await fetch(BASE_URL + "Contacts.json");
    return response.json() || {};
}

/**
 * Determines the old and new letter groups based on the edited contact's information.
 * @function getLetterGroups
 * @param {Object} contacts - The contacts object grouped by letters.
 * @param {string} newName - The new name of the contact.
 * @param {string} currentEmail - The current email of the contact.
 * @returns {Object} An object containing the old and new letter groups.
 */
function getLetterGroups(contacts, newName, currentEmail) {
    const oldLetter = findCurrentLetter(contacts, currentEmail);
    const newLetter = newName.charAt(0).toUpperCase();
    return { oldLetter, newLetter };
}

/**
 * Finds the current letter group for the contact with the specified email.
 * @function findCurrentLetter
 * @param {Object} contacts - The contacts object grouped by letters.
 * @param {string} currentEmail - The email of the contact.
 * @returns {string} The letter group where the contact belongs.
 */
function findCurrentLetter(contacts, currentEmail) {
    return Object.keys(contacts).find(letter =>
        contacts[letter]?.some(c => c.email === currentEmail)
    );
}

/**
 * Modifies the contacts object by removing the old contact and adding the updated contact.
 * @function modifyContacts
 * @param {Object} contacts - The contacts object grouped by letters.
 * @param {Object} updatedContact - The updated contact object.
 * @param {string} oldLetter - The old letter group of the contact.
 * @param {string} newLetter - The new letter group of the contact.
 * @param {string} currentEmail - The current email of the contact.
 * @returns {void}
 */
function modifyContacts(contacts, updatedContact, oldLetter, newLetter, currentEmail) {
    removeFromOldGroup(contacts, oldLetter, currentEmail);
    addToNewGroup(contacts, newLetter, updatedContact);
}

/**
 * Removes a contact from its old letter group.
 * @function removeFromOldGroup
 * @param {Object} contacts - The contacts object grouped by letters.
 * @param {string} oldLetter - The old letter group of the contact.
 * @param {string} currentEmail - The email of the contact to be removed.
 * @returns {void}
 */
function removeFromOldGroup(contacts, oldLetter, currentEmail) {
    contacts[oldLetter] = contacts[oldLetter].filter(c => c.email !== currentEmail);
    if (!contacts[oldLetter].length) delete contacts[oldLetter];
}

/**
 * Adds a contact to its new letter group.
 * @function addToNewGroup
 * @param {Object} contacts - The contacts object grouped by letters.
 * @param {string} newLetter - The new letter group of the contact.
 * @param {Object} updatedContact - The updated contact to be added.
 * @returns {void}
 */
function addToNewGroup(contacts, newLetter, updatedContact) {
    if (!contacts[newLetter]) contacts[newLetter] = [];
    contacts[newLetter].push(updatedContact);
}

/**
 * Saves the updated contacts object to the server.
 * @async
 * @function saveContacts
 * @param {Object} contacts - The contacts object to be saved.
 * @returns {Promise&lt;void>}
 */
async function saveContacts(contacts) {
    await fetch(BASE_URL + "Contacts.json", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(contacts),
    });
}

/**
 * Finalizes the contact editing process by hiding the edit form and reloading the contacts.
 * @function finalizeContactEditing
 * @param {Object} updatedContact - The updated contact that has been edited.
 * @returns {void}
 */
function finalizeContactEditing(updatedContact) {
    const form = document.getElementById("editContactForm");
    form.classList.add("hidden");
    loadContacts();
    displayContactInfo(
        updatedContact.name,
        updatedContact.email,
        updatedContact.phone,
        getInitials(updatedContact.name),
        updatedContact.bgColor
    );
}

/**
 * Deletes a contact based on the provided email.
 * @async
 * @function deleteContact
 * @param {string} contactEmail - The email of the contact to be deleted.
 * @returns {Promise&lt;void>}
 */
async function deleteContact(contactEmail) {
    const response = await fetch(BASE_URL + "Contacts.json");
    const contacts = await response.json();
    const letters = Object.keys(contacts);
    for (let i = 0; i &lt; letters.length; i++) {
        const letter = letters[i];
        const contactGroup = contacts[letter];
        const index = contactGroup.findIndex(contact => contact.email === contactEmail);
        
        if (index !== -1) {
            contactGroup.splice(index, 1);
            break;
        }
    }
    await fetch(BASE_URL + "Contacts.json", {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(contacts),
    });
    loadAll()
}

/**
 * The main function that runs when the page is loaded. It initiates the loading of all contacts.
 * @async
 * @function main
 * @returns {Promise&lt;void>}
 */
(async function main() {
    await loadAll();
})();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Events</h3><ul><li><a href="window.html#event:onload">onload</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addAccountData">addAccountData</a></li><li><a href="global.html#addDNone">addDNone</a></li><li><a href="global.html#addSubtask">addSubtask</a></li><li><a href="global.html#addTaskInBoard">addTaskInBoard</a></li><li><a href="global.html#addToNewGroup">addToNewGroup</a></li><li><a href="global.html#cancelCreateContact">cancelCreateContact</a></li><li><a href="global.html#cancelEdit">cancelEdit</a></li><li><a href="global.html#changeTaskFields">changeTaskFields</a></li><li><a href="global.html#changeToDropOffJson">changeToDropOffJson</a></li><li><a href="global.html#checkAndPutToServer">checkAndPutToServer</a></li><li><a href="global.html#checkAwait">checkAwait</a></li><li><a href="global.html#checkEverythingInTask">checkEverythingInTask</a></li><li><a href="global.html#checkForAddedUsers">checkForAddedUsers</a></li><li><a href="global.html#checkForCategory">checkForCategory</a></li><li><a href="global.html#checkForExistingAccount">checkForExistingAccount</a></li><li><a href="global.html#checkForGreeting">checkForGreeting</a></li><li><a href="global.html#checkForImportance">checkForImportance</a></li><li><a href="global.html#checkForLoadedPage">checkForLoadedPage</a></li><li><a href="global.html#checkForMailAdress">checkForMailAdress</a></li><li><a href="global.html#checkForSubtasks">checkForSubtasks</a></li><li><a href="global.html#checkForUrgent">checkForUrgent</a></li><li><a href="global.html#checkInProgress">checkInProgress</a></li><li><a href="global.html#checkToDo">checkToDo</a></li><li><a href="global.html#clearInputs">clearInputs</a></li><li><a href="global.html#clearInuptField">clearInuptField</a></li><li><a href="global.html#closeContactInfo">closeContactInfo</a></li><li><a href="global.html#contactSelected">contactSelected</a></li><li><a href="global.html#content">content</a></li><li><a href="global.html#createContact">createContact</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#currentUserName">currentUserName</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteSubtask">deleteSubtask</a></li><li><a href="global.html#deleteTaskFromBoard">deleteTaskFromBoard</a></li><li><a href="global.html#displayContactInfo">displayContactInfo</a></li><li><a href="global.html#displayCounts">displayCounts</a></li><li><a href="global.html#dragoverHandler">dragoverHandler</a></li><li><a href="global.html#dragstartHandler">dragstartHandler</a></li><li><a href="global.html#dropHandler">dropHandler</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#editSubtask">editSubtask</a></li><li><a href="global.html#editTaskInBoard">editTaskInBoard</a></li><li><a href="global.html#fetchContacts">fetchContacts</a></li><li><a href="global.html#fetchUserFromFirebase">fetchUserFromFirebase</a></li><li><a href="global.html#finalizeContactEditing">finalizeContactEditing</a></li><li><a href="global.html#findCurrentLetter">findCurrentLetter</a></li><li><a href="global.html#gatherAllTaskData">gatherAllTaskData</a></li><li><a href="global.html#getAddedContacts">getAddedContacts</a></li><li><a href="global.html#getAndDisplayName">getAndDisplayName</a></li><li><a href="global.html#getCategory">getCategory</a></li><li><a href="global.html#getContactInfoTemplate">getContactInfoTemplate</a></li><li><a href="global.html#getContacts">getContacts</a></li><li><a href="global.html#getContactsWithThisLetter">getContactsWithThisLetter</a></li><li><a href="global.html#getCurrentMailForButtons">getCurrentMailForButtons</a></li><li><a href="global.html#getCurrentMovedTask">getCurrentMovedTask</a></li><li><a href="global.html#getEditedContactInputs">getEditedContactInputs</a></li><li><a href="global.html#getGreeting">getGreeting</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getInitialsOfAddedUser">getInitialsOfAddedUser</a></li><li><a href="global.html#getInitialsOfAddedUsers">getInitialsOfAddedUsers</a></li><li><a href="global.html#getLetterGroups">getLetterGroups</a></li><li><a href="global.html#getLoadContactTemplate">getLoadContactTemplate</a></li><li><a href="global.html#getNewTaskInfo">getNewTaskInfo</a></li><li><a href="global.html#getPriority">getPriority</a></li><li><a href="global.html#getRandomColor">getRandomColor</a></li><li><a href="global.html#getToDoTasks">getToDoTasks</a></li><li><a href="global.html#getUrgentAmount">getUrgentAmount</a></li><li><a href="global.html#getUserCount">getUserCount</a></li><li><a href="global.html#goToSignUp">goToSignUp</a></li><li><a href="global.html#initAddTask">initAddTask</a></li><li><a href="global.html#initBoards">initBoards</a></li><li><a href="global.html#initLogin">initLogin</a></li><li><a href="global.html#initStartPage">initStartPage</a></li><li><a href="global.html#initSummary">initSummary</a></li><li><a href="global.html#loadAll">loadAll</a></li><li><a href="global.html#loadContacts">loadContacts</a></li><li><a href="global.html#loadContactsSecondFunction">loadContactsSecondFunction</a></li><li><a href="global.html#loadCss">loadCss</a></li><li><a href="global.html#loadHtml">loadHtml</a></li><li><a href="global.html#loadPage">loadPage</a></li><li><a href="global.html#loadScript">loadScript</a></li><li><a href="global.html#loadUserData">loadUserData</a></li><li><a href="global.html#loginWithAccount">loginWithAccount</a></li><li><a href="global.html#logoSlideIn">logoSlideIn</a></li><li><a href="global.html#main">main</a></li><li><a href="global.html#modifyContacts">modifyContacts</a></li><li><a href="global.html#navbarLinks">navbarLinks</a></li><li><a href="global.html#pagesWithScripts">pagesWithScripts</a></li><li><a href="global.html#postAccoundData">postAccoundData</a></li><li><a href="global.html#putAllTasksToServer">putAllTasksToServer</a></li><li><a href="global.html#putEditedTaskToServer">putEditedTaskToServer</a></li><li><a href="global.html#putTaskToServer">putTaskToServer</a></li><li><a href="global.html#putToServer">putToServer</a></li><li><a href="global.html#putUserAmountToServer">putUserAmountToServer</a></li><li><a href="global.html#reloadPage">reloadPage</a></li><li><a href="global.html#removeFromOldGroup">removeFromOldGroup</a></li><li><a href="global.html#renderAddContactForm">renderAddContactForm</a></li><li><a href="global.html#renderAllSubtasks">renderAllSubtasks</a></li><li><a href="global.html#renderAllTasks">renderAllTasks</a></li><li><a href="global.html#renderAwaitFeedback">renderAwaitFeedback</a></li><li><a href="global.html#renderCategoryTechnical">renderCategoryTechnical</a></li><li><a href="global.html#renderCategoryUser">renderCategoryUser</a></li><li><a href="global.html#renderClosestDate">renderClosestDate</a></li><li><a href="global.html#renderContact">renderContact</a></li><li><a href="global.html#renderDetails">renderDetails</a></li><li><a href="global.html#renderDone">renderDone</a></li><li><a href="global.html#renderInProgress">renderInProgress</a></li><li><a href="global.html#renderInitials">renderInitials</a></li><li><a href="global.html#renderNoteToEdit">renderNoteToEdit</a></li><li><a href="global.html#renderSubtasks">renderSubtasks</a></li><li><a href="global.html#renderTasksinBoard">renderTasksinBoard</a></li><li><a href="global.html#renderToDo">renderToDo</a></li><li><a href="global.html#renderUrgent">renderUrgent</a></li><li><a href="global.html#resetAllBoards">resetAllBoards</a></li><li><a href="global.html#resetAllVars">resetAllVars</a></li><li><a href="global.html#resetContactList">resetContactList</a></li><li><a href="global.html#saveContacts">saveContacts</a></li><li><a href="global.html#saveEditedContact">saveEditedContact</a></li><li><a href="global.html#saveSubtask">saveSubtask</a></li><li><a href="global.html#searchTasksInBoard">searchTasksInBoard</a></li><li><a href="global.html#setAwaitFeedbackTaskCount">setAwaitFeedbackTaskCount</a></li><li><a href="global.html#setDoneTaskCount">setDoneTaskCount</a></li><li><a href="global.html#setInProgressTaskCount">setInProgressTaskCount</a></li><li><a href="global.html#setToDoTaskCount">setToDoTaskCount</a></li><li><a href="global.html#setUsersAmount">setUsersAmount</a></li><li><a href="global.html#subtaskSelected">subtaskSelected</a></li><li><a href="global.html#toggleMenu">toggleMenu</a></li><li><a href="global.html#toggleNoteDetails">toggleNoteDetails</a></li><li><a href="global.html#updateAllTaskCounts">updateAllTaskCounts</a></li><li><a href="global.html#updateAndUploadAllTaskCounts">updateAndUploadAllTaskCounts</a></li><li><a href="global.html#updateTask">updateTask</a></li><li><a href="global.html#uploadAllTaskCounts">uploadAllTaskCounts</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Dec 16 2024 16:12:52 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
