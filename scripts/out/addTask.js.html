<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: addTask.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: addTask.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>let firstLetters = [];
let selectedContatct = [];
let selectedContatctBgColor = [];
let addedSubtasks = [];
let addedSubtaskDone = [];

/**
 * Initializes the task creation process by clearing the input fields.
 * @function initAddTask
 * @returns {void}
 */
function initAddTask() {
    clearInputs();
}

/**
 * Fetches the contacts from the server and organizes them by their first letter.
 * Resets the contact list before fetching.
 * @async
 * @function getContacts
 * @returns {Promise&lt;void>}
 */
async function getContacts() {
    resetContactList();
    let response = await fetch(BASE_URL + "Contacts.json");
    responseToJson = await response.json();
    firstLetters = Object.keys(responseToJson);
    for (let indexContactLetters = 0; indexContactLetters &lt; firstLetters.length; indexContactLetters++) {
        await getContactsWithThisLetter(indexContactLetters);
    }
    document.getElementById("openContactsDiv").classList.toggle("d-none");
}

/**
 * Fetches and renders the contacts for a specific letter group.
 * @async
 * @function getContactsWithThisLetter
 * @param {number} indexContactLetters - The index of the letter group.
 * @returns {Promise&lt;void>}
 */
async function getContactsWithThisLetter(indexContactLetters) {
    let response = await fetch(BASE_URL + `Contacts/${firstLetters[indexContactLetters]}.json`);
    responseToJson = await response.json();
    for (let indexContactWithLetter = 0; indexContactWithLetter &lt; responseToJson.length; indexContactWithLetter++) {
        renderContact(responseToJson, indexContactWithLetter);
    }
}

/**
 * Creates a new task by gathering all the necessary information and saving it to the server.
 * Updates the task count and reloads the page.
 * @async
 * @function createTask
 * @returns {Promise&lt;void>}
 */
async function createTask() {
    toDoTaskCount++;
    getNewTaskInfo();
    await putTaskToServer();
    await setToDoTaskCount();
    resetAllVars();
    reloadPage();
}

/**
 * Gathers the information for a new task from the input fields.
 * @function getNewTaskInfo
 * @returns {Object} The gathered task data.
 */
function getNewTaskInfo() {
    let newTitle = document.getElementById("titleInput").value;
    let newDescription = document.getElementById("descriptionInput").value;
    let newDate = document.getElementById("dateIput").value;
    getCategory();
    getPriority();
    getAddedContacts();
    gatherAllTaskData(newTitle, newDescription, newDate);
    return newTaskData;
}

/**
 * Retrieves the selected contacts for the task.
 * @function getAddedContacts
 * @returns {Array} An array of selected contacts or an empty string if none are selected.
 */
function getAddedContacts() {
    if (selectedContatct.length != 0) {
        newAssigned = selectedContatct;
        newAssignedBgColor = selectedContatctBgColor;
        return newAssigned;
    } else {
        newAssigned = "";
        newAssignedBgColor = "";
        return newAssigned;
    }
}

/**
 * Retrieves the selected priority for the task.
 * @function getPriority
 * @returns {string} The priority of the task, which could be 'high', 'medium', or 'low'.
 */
function getPriority() {
    if (document.getElementById("IDhigh").checked) {
        newPrio = "high";
        return newPrio;
    } else if (document.getElementById("IDmedium").checked) {
        newPrio = "medium";
        return newPrio;
    } else {
        newPrio = "low";
        return newPrio;
    }
}

/**
 * Retrieves the selected category for the task.
 * @function getCategory
 * @returns {string} The category of the task, which could be 'technical' or 'user'.
 */
function getCategory() {
    if (document.getElementById("categorytSelector").value == "technicalTask") {
        newCategory = "technical";
        return newCategory;
    } else if (document.getElementById("categorytSelector").value == "userStory") {
        newCategory = "user";
        return newCategory;
    } else {
        selectCategoryErr();
    }
}

/**
 * Gathers all the data for the new task into an object.
 * @function gatherAllTaskData
 * @param {string} newTitle - The title of the new task.
 * @param {string} newDescription - The description of the new task.
 * @param {string} newDate - The due date of the new task.
 * @returns {Object} The task data object.
 */
function gatherAllTaskData(newTitle, newDescription, newDate) {
    newTaskData = {
        "title": newTitle,
        "description": newDescription,
        "date": newDate,
        "assigned": newAssigned,
        "assignedBgColor": newAssignedBgColor,
        "priority": newPrio,
        "category": newCategory,
        "subtasks": {
            "addedTask": addedSubtasks,
            "subtasksDone": addedSubtaskDone,
        },
    };
    return newTaskData;
}

/**
 * Sends the new task data to the server and stores it.
 * @async
 * @function putTaskToServer
 * @returns {Promise&lt;Object>} The response from the server after storing the task.
 */
async function putTaskToServer() {
    let response = await fetch(BASE_URL + `Tasks/ToDo/${toDoTaskCount}.json`, {
        method: "put",
        header: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(newTaskData)
    });
    return responseToJson = await response.json();
}

/**
 * Updates the task count for the 'ToDo' tasks on the server.
 * @async
 * @function setToDoTaskCount
 * @returns {Promise&lt;Object>} The response from the server after updating the task count.
 */
async function setToDoTaskCount() {
    let response = await fetch(BASE_URL + `TaskCounts/ToDoTaskCount/.json`, {
        method: "put",
        header: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(toDoTaskCount)
    });
    return responseToJson = await response.json();
}

/**
 * Toggles the selection of a contact. Adds or removes the contact from the selected list.
 * @function contactSelected
 * @param {string} name - The name of the selected contact.
 * @param {string} bgColor - The background color of the contact.
 * @returns {void}
 */
function contactSelected(name, bgColor) {
    if (selectedContatct.includes(name)) {
        let index = selectedContatct.indexOf(name);
        selectedContatct.splice(index, 1);
        selectedContatctBgColor.splice(index, 1);
        console.log(selectedContatct);
    } else {
        selectedContatct.push(name);
        selectedContatctBgColor.push(bgColor);
        console.log(selectedContatct);
    }
    document.getElementById(name).classList.toggle("selectedContact");
    getInitialsOfAddedUser();
}

/**
 * Updates the display of selected contacts' initials.
 * @function getInitialsOfAddedUser
 * @returns {void}
 */
function getInitialsOfAddedUser() {
    document.getElementById("showAddedContacts").innerHTML = "";
    for (let index = 0; index &lt; selectedContatct.length; index++) {
        const nameParts = selectedContatct[index].split(' ');
        const firstInitial = nameParts[0]?.charAt(0).toUpperCase();
        const lastInitial = nameParts[1]?.charAt(0).toUpperCase();
        document.getElementById("showAddedContacts").innerHTML += `&lt;p class= "addedUserInitials" style="background-color: ${selectedContatctBgColor[index]};" >${firstInitial}${lastInitial}&lt;/p>`;
    }
}

/**
 * Resets all the variables related to task creation.
 * @function resetAllVars
 * @returns {void}
 */
function resetAllVars() {
    firstLetters = [];
    selectedContatct = [];
    addedSubtasks = [];
}

/**
 * Reloads the page after a task is added to the board.
 * @async
 * @function reloadPage
 * @returns {Promise&lt;void>}
 */
async function reloadPage() {
    document.getElementById("main-content").innerHTML = `&lt;div class="addedTaskToBoardBtn">&lt;p>Task added to board&lt;/p> &lt;img src="./assets/icons/Vector.svg" alt="">&lt;/div>`;
    console.log(1);
    await new Promise(r => setTimeout(r, 2000));
    loadPage('board');
}

/**
 * Deletes a subtask from the task list.
 * @function deleteSubtask
 * @param {string} subtaskName - The name of the subtask to be deleted.
 * @returns {void}
 */
function deleteSubtask(subtaskName) {
    let index = addedSubtasks.indexOf(subtaskName);
    addedSubtasks.splice(index, 1);
    addedSubtaskDone.splice(index, 1);
    renderAllSubtasks();
}

/**
 * Edits an existing subtask by allowing the user to change its name.
 * @function editSubtask
 * @param {HTMLElement} subtaskContainer - The container where the subtask is displayed.
 * @param {string} oldName - The current name of the subtask.
 * @returns {void}
 */
function editSubtask(subtaskContainer, oldName) {
    let editInput = document.createElement('input');
    editInput.type = 'text';
    editInput.value = oldName;
    editInput.classList.add('editSubtaskInput');
    subtaskContainer.innerHTML = "";
    let saveButton = document.createElement('button');
    saveButton.textContent = 'Save';
    saveButton.onclick = () => saveSubtask(subtaskContainer, editInput.value, oldName);
    subtaskContainer.appendChild(editInput);
    subtaskContainer.appendChild(saveButton);
}

/**
 * Clears the input field for adding a subtask.
 * @function clearInuptField
 * @returns {void}
 */
function clearInuptField() {
    document.getElementById("subtaskInput").value = "";
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Events</h3><ul><li><a href="window.html#event:onload">onload</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addAccountData">addAccountData</a></li><li><a href="global.html#addDNone">addDNone</a></li><li><a href="global.html#addSubtask">addSubtask</a></li><li><a href="global.html#addTaskInBoard">addTaskInBoard</a></li><li><a href="global.html#addToNewGroup">addToNewGroup</a></li><li><a href="global.html#cancelCreateContact">cancelCreateContact</a></li><li><a href="global.html#cancelEdit">cancelEdit</a></li><li><a href="global.html#changeTaskFields">changeTaskFields</a></li><li><a href="global.html#changeToDropOffJson">changeToDropOffJson</a></li><li><a href="global.html#checkAndPutToServer">checkAndPutToServer</a></li><li><a href="global.html#checkAwait">checkAwait</a></li><li><a href="global.html#checkEverythingInTask">checkEverythingInTask</a></li><li><a href="global.html#checkForAddedUsers">checkForAddedUsers</a></li><li><a href="global.html#checkForCategory">checkForCategory</a></li><li><a href="global.html#checkForExistingAccount">checkForExistingAccount</a></li><li><a href="global.html#checkForGreeting">checkForGreeting</a></li><li><a href="global.html#checkForImportance">checkForImportance</a></li><li><a href="global.html#checkForLoadedPage">checkForLoadedPage</a></li><li><a href="global.html#checkForMailAdress">checkForMailAdress</a></li><li><a href="global.html#checkForSubtasks">checkForSubtasks</a></li><li><a href="global.html#checkForUrgent">checkForUrgent</a></li><li><a href="global.html#checkInProgress">checkInProgress</a></li><li><a href="global.html#checkToDo">checkToDo</a></li><li><a href="global.html#clearInputs">clearInputs</a></li><li><a href="global.html#clearInuptField">clearInuptField</a></li><li><a href="global.html#closeContactInfo">closeContactInfo</a></li><li><a href="global.html#contactSelected">contactSelected</a></li><li><a href="global.html#content">content</a></li><li><a href="global.html#createContact">createContact</a></li><li><a href="global.html#createTask">createTask</a></li><li><a href="global.html#currentUserName">currentUserName</a></li><li><a href="global.html#deleteContact">deleteContact</a></li><li><a href="global.html#deleteSubtask">deleteSubtask</a></li><li><a href="global.html#deleteTaskFromBoard">deleteTaskFromBoard</a></li><li><a href="global.html#displayContactInfo">displayContactInfo</a></li><li><a href="global.html#displayCounts">displayCounts</a></li><li><a href="global.html#dragoverHandler">dragoverHandler</a></li><li><a href="global.html#dragstartHandler">dragstartHandler</a></li><li><a href="global.html#dropHandler">dropHandler</a></li><li><a href="global.html#editContact">editContact</a></li><li><a href="global.html#editSubtask">editSubtask</a></li><li><a href="global.html#editTaskInBoard">editTaskInBoard</a></li><li><a href="global.html#fetchContacts">fetchContacts</a></li><li><a href="global.html#fetchUserFromFirebase">fetchUserFromFirebase</a></li><li><a href="global.html#finalizeContactEditing">finalizeContactEditing</a></li><li><a href="global.html#findCurrentLetter">findCurrentLetter</a></li><li><a href="global.html#gatherAllTaskData">gatherAllTaskData</a></li><li><a href="global.html#getAddedContacts">getAddedContacts</a></li><li><a href="global.html#getAndDisplayName">getAndDisplayName</a></li><li><a href="global.html#getCategory">getCategory</a></li><li><a href="global.html#getContactInfoTemplate">getContactInfoTemplate</a></li><li><a href="global.html#getContacts">getContacts</a></li><li><a href="global.html#getContactsWithThisLetter">getContactsWithThisLetter</a></li><li><a href="global.html#getCurrentMailForButtons">getCurrentMailForButtons</a></li><li><a href="global.html#getCurrentMovedTask">getCurrentMovedTask</a></li><li><a href="global.html#getEditedContactInputs">getEditedContactInputs</a></li><li><a href="global.html#getGreeting">getGreeting</a></li><li><a href="global.html#getInitials">getInitials</a></li><li><a href="global.html#getInitialsOfAddedUser">getInitialsOfAddedUser</a></li><li><a href="global.html#getInitialsOfAddedUsers">getInitialsOfAddedUsers</a></li><li><a href="global.html#getLetterGroups">getLetterGroups</a></li><li><a href="global.html#getLoadContactTemplate">getLoadContactTemplate</a></li><li><a href="global.html#getNewTaskInfo">getNewTaskInfo</a></li><li><a href="global.html#getPriority">getPriority</a></li><li><a href="global.html#getRandomColor">getRandomColor</a></li><li><a href="global.html#getToDoTasks">getToDoTasks</a></li><li><a href="global.html#getUrgentAmount">getUrgentAmount</a></li><li><a href="global.html#getUserCount">getUserCount</a></li><li><a href="global.html#goToSignUp">goToSignUp</a></li><li><a href="global.html#initAddTask">initAddTask</a></li><li><a href="global.html#initBoards">initBoards</a></li><li><a href="global.html#initLogin">initLogin</a></li><li><a href="global.html#initStartPage">initStartPage</a></li><li><a href="global.html#initSummary">initSummary</a></li><li><a href="global.html#loadAll">loadAll</a></li><li><a href="global.html#loadContacts">loadContacts</a></li><li><a href="global.html#loadContactsSecondFunction">loadContactsSecondFunction</a></li><li><a href="global.html#loadCss">loadCss</a></li><li><a href="global.html#loadHtml">loadHtml</a></li><li><a href="global.html#loadPage">loadPage</a></li><li><a href="global.html#loadScript">loadScript</a></li><li><a href="global.html#loadUserData">loadUserData</a></li><li><a href="global.html#loginWithAccount">loginWithAccount</a></li><li><a href="global.html#logoSlideIn">logoSlideIn</a></li><li><a href="global.html#main">main</a></li><li><a href="global.html#modifyContacts">modifyContacts</a></li><li><a href="global.html#navbarLinks">navbarLinks</a></li><li><a href="global.html#pagesWithScripts">pagesWithScripts</a></li><li><a href="global.html#postAccoundData">postAccoundData</a></li><li><a href="global.html#putAllTasksToServer">putAllTasksToServer</a></li><li><a href="global.html#putEditedTaskToServer">putEditedTaskToServer</a></li><li><a href="global.html#putTaskToServer">putTaskToServer</a></li><li><a href="global.html#putToServer">putToServer</a></li><li><a href="global.html#putUserAmountToServer">putUserAmountToServer</a></li><li><a href="global.html#reloadPage">reloadPage</a></li><li><a href="global.html#removeFromOldGroup">removeFromOldGroup</a></li><li><a href="global.html#renderAddContactForm">renderAddContactForm</a></li><li><a href="global.html#renderAllSubtasks">renderAllSubtasks</a></li><li><a href="global.html#renderAllTasks">renderAllTasks</a></li><li><a href="global.html#renderAwaitFeedback">renderAwaitFeedback</a></li><li><a href="global.html#renderCategoryTechnical">renderCategoryTechnical</a></li><li><a href="global.html#renderCategoryUser">renderCategoryUser</a></li><li><a href="global.html#renderClosestDate">renderClosestDate</a></li><li><a href="global.html#renderContact">renderContact</a></li><li><a href="global.html#renderDetails">renderDetails</a></li><li><a href="global.html#renderDone">renderDone</a></li><li><a href="global.html#renderInProgress">renderInProgress</a></li><li><a href="global.html#renderInitials">renderInitials</a></li><li><a href="global.html#renderNoteToEdit">renderNoteToEdit</a></li><li><a href="global.html#renderSubtasks">renderSubtasks</a></li><li><a href="global.html#renderTasksinBoard">renderTasksinBoard</a></li><li><a href="global.html#renderToDo">renderToDo</a></li><li><a href="global.html#renderUrgent">renderUrgent</a></li><li><a href="global.html#resetAllBoards">resetAllBoards</a></li><li><a href="global.html#resetAllVars">resetAllVars</a></li><li><a href="global.html#resetContactList">resetContactList</a></li><li><a href="global.html#saveContacts">saveContacts</a></li><li><a href="global.html#saveEditedContact">saveEditedContact</a></li><li><a href="global.html#saveSubtask">saveSubtask</a></li><li><a href="global.html#searchTasksInBoard">searchTasksInBoard</a></li><li><a href="global.html#setAwaitFeedbackTaskCount">setAwaitFeedbackTaskCount</a></li><li><a href="global.html#setDoneTaskCount">setDoneTaskCount</a></li><li><a href="global.html#setInProgressTaskCount">setInProgressTaskCount</a></li><li><a href="global.html#setToDoTaskCount">setToDoTaskCount</a></li><li><a href="global.html#setUsersAmount">setUsersAmount</a></li><li><a href="global.html#subtaskSelected">subtaskSelected</a></li><li><a href="global.html#toggleMenu">toggleMenu</a></li><li><a href="global.html#toggleNoteDetails">toggleNoteDetails</a></li><li><a href="global.html#updateAllTaskCounts">updateAllTaskCounts</a></li><li><a href="global.html#updateAndUploadAllTaskCounts">updateAndUploadAllTaskCounts</a></li><li><a href="global.html#updateTask">updateTask</a></li><li><a href="global.html#uploadAllTaskCounts">uploadAllTaskCounts</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Dec 16 2024 16:12:52 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
